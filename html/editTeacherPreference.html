<!doctype html>
<link rel="stylesheet" type="text/css" href="style.css">
<html>
<head>
	<meta charset="utf-8" />
	<title>Teacher Preferences</title>
	
</head>

<body>
	<h1>Hired Teachers</h1>
	<table id="contacts-table">
		<tr id="contacts-head">
			<th>#</th>
			<th>Name</th>
			<th>PIN</th>
			<th>Subject(s)</th>
			<th>School</th>
			<th>Missing Class</th>
			<th>Actions</th>
		</tr>
	</table>

	<form id="contacts-form">
		<div class="item text">
			<label>Name:</label>
			<div class="field"><input type="text" name="hired_name" /></div>
		</div>
		<div class="item text">
			<label>PIN:</label>
			<div class="field"><input type="text" name="hired_SSN" /></div>
		</div>
		<div class="item text">
			<label>Subject:</label>
			<div class="field"><input type="text" name="hired_subject" /></div>
		</div>
		<div class="item text">
			<label>School:</label>
			<div class="field"><input type="text" name="hired_school" /></div>
		</div>
		
		<div class="item text">
			<label>Missing Class:</label>
			<div class="field"><input type="checkbox" name="hired_missingClass" /></div>
		</div>

		<div class="button-wrapper">
			<div class="item button">
				<div class="field"><input type="button" id="contacts-op-discard" value="Discard" /></div>
			</div>
			<div class="item button button-default">
				<div class="field"><input type="submit" id="contacts-op-save" value="Save" /></div>
			</div>
		</div>
		<input type="hidden" name="id_entry" value="0" />
	</form>

	<script>
		var Contacts = {
			index: window.localStorage.getItem("Contacts:index"),
			$table: document.getElementById("contacts-table"),
			$form: document.getElementById("contacts-form"),
			$button_save: document.getElementById("contacts-op-save"),
			$button_discard: document.getElementById("contacts-op-discard"),

			init: function() {
				// initialize storage index
				if (!Contacts.index) {
					window.localStorage.setItem("Contacts:index", Contacts.index = 1);
				}

				// initialize form
				Contacts.$form.reset();
				Contacts.$button_discard.addEventListener("click", function(event) {
					Contacts.$form.reset();
					Contacts.$form.id_entry.value = 0;
				}, true);
				Contacts.$form.addEventListener("submit", function(event) {
					var entry = {
						id: parseInt(this.id_entry.value),
						hired_name: this.hired_name.value,
						hired_SSN: this.hired_SSN.value,
						hired_subject: this.hired_subject.value,
						hired_school:this.hired_school.value,
						hired_missingClass: "no"
					};
					
					if(this.hired_missingClass.checked==true){
						entry.hired_missingClass="yes";
					}
					else{ 
						entry.hired_missingClass="no";
					}
					
					if (entry.id == 0) { // add
						Contacts.storeAdd(entry);
						Contacts.tableAdd(entry);
					}
					else { // edit
						Contacts.storeEdit(entry);
						Contacts.tableEdit(entry);
					}

					this.reset();
					this.id_entry.value = 0;
					event.preventDefault();
				}, true);

				// initialize table
				if (window.localStorage.length - 1) {
					var contacts_list = [], i, key;
					for (i = 0; i < window.localStorage.length; i++) {
						key = window.localStorage.key(i);
						if (/Contacts:\d+/.test(key)) {
							contacts_list.push(JSON.parse(window.localStorage.getItem(key)));
						}
					}

					if (contacts_list.length) {
						contacts_list
							.sort(function(a, b) {
								return a.id < b.id ? -1 : (a.id > b.id ? 1 : 0);
							})
							.forEach(Contacts.tableAdd);
					}
				}
				Contacts.$table.addEventListener("click", function(event) {
					var op = event.target.getAttribute("data-op");
					if (/edit|remove/.test(op)) {
						var entry = JSON.parse(window.localStorage.getItem("Contacts:"+ event.target.getAttribute("data-id")));
						if (op == "edit") {
							Contacts.$form.id_entry.value = entry.id;
							Contacts.$form.hired_name.value = entry.hired_name;
							Contacts.$form.hired_SSN.value = entry.hired_SSN;
							Contacts.$form.hired_subject.value = entry.hired_subject;
							Contacts.$form.hired_school.value = entry.hired_school;
							
							console.log(entry.hired_missingClass);
							if(entry.hired_missingClass=="yes"){ 
								Contacts.$form.hired_missingClass.checked=true;
							}
							else{ 
								Contacts.$form.hired_missingClass.checked=false;
							}
							
						}
						else if (op == "remove") {
							if (confirm('Are you sure you want to remove "'+ entry.hired_name +' '+ entry.hired_SSN +'" from your contacts?')) {
								Contacts.storeRemove(entry);
								Contacts.tableRemove(entry);
							}
						}
						event.preventDefault();
					}
				}, true);
			},

			storeAdd: function(entry) {
				entry.id = Contacts.index;
				window.localStorage.setItem("Contacts:index", ++Contacts.index);
				window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
			},
			storeEdit: function(entry) {
				window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
			},
			storeRemove: function(entry) {
				window.localStorage.removeItem("Contacts:"+ entry.id);
			},

			tableAdd: function(entry) {
				var $tr = document.createElement("tr"), $td, key;
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
				$tr.setAttribute("id", "entry-"+ entry.id);
				Contacts.$table.appendChild($tr);
			},
			tableEdit: function(entry) {
				var $tr = document.getElementById("entry-"+ entry.id), $td, key;
				$tr.innerHTML = "";
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
			},
			tableRemove: function(entry) {
				Contacts.$table.removeChild(document.getElementById("entry-"+ entry.id));
			}
		};
		Contacts.init();
	</script>
	
	
	
		<h1>Subtitute Teachers</h1>
	<table id="Substitutes-table">
		<tr id="Substitutes-head">
			<th>#</th>
			<th>Name</th>
			<th>PIN</th>
			<th>SSN</th>
			<th>Phone</th>
			<th>Subjects</th>
			<th>Schools</th>
			<th>Grade Levels</th>
			<th>Actions</th>
		</tr>
	</table>

	<form id="Substitutes-form">
		<div class="item text">
			<label>Name:</label>
			<div class="field"><input type="text" name="sub_name" /></div>
		</div>
		<div class="item text">
			<label>PIN:</label>
			<div class="field"><input type="text" name="sub_PIN" /></div>
		</div>
		<div class="item text">
			<label>SSN:</label>
			<div class="field"><input type="text" name="sub_SSN" /></div>
		</div>
			<div class="item text">
			<label>Phone:</label>
			<div class="field"><input type="text" name="sub_phone" /></div>
		</div>
		
		<div class="item text">
			<label>Subjects:</label>
			<div class="field"><input type="text" name="sub_subject" /></div>
		</div>
		<div class="item text">
			<label>Schools:</label>
			<div class="field"><input type="text" name="sub_school" /></div>
		</div>
		<div class="item text">
			<label>Grade levels:</label>
			<div class="field"><input type="text" name="sub_gradeLevel" /> </div><nbsp><i>Options: K,J,H,A<i/> 
		</div>
		<div class="button-wrapper">
			<div class="item button">
				<div class="field"><input type="button" id="Substitutes-op-discard" value="Discard" /></div>
			</div>
			<div class="item button button-default">
				<div class="field"><input type="submit" id="Substitutes-op-save" value="Save" /></div>
			</div>
		</div>
		<input type="hidden" name="id_entry" value="0" />
	</form>

	<script>
		var Substitutes = {
			index: window.localStorage.getItem("Substitutes:index"),
			$table: document.getElementById("Substitutes-table"),
			$form: document.getElementById("Substitutes-form"),
			$button_save: document.getElementById("Substitutes-op-save"),
			$button_discard: document.getElementById("Substitutes-op-discard"),

			init: function() {
				// initialize storage index
				if (!Substitutes.index) {
					window.localStorage.setItem("Substitutes:index", Substitutes.index = 1);
				}

				// initialize form
				Substitutes.$form.reset();
				Substitutes.$button_discard.addEventListener("click", function(event) {
					Substitutes.$form.reset();
					Substitutes.$form.id_entry.value = 0;
				}, true);
				Substitutes.$form.addEventListener("submit", function(event) {
					var entry = {
						id: parseInt(this.id_entry.value),
						sub_name: this.sub_name.value,
						sub_PIN: this.sub_PIN.value,
						sub_SSN: this.sub_SSN.value,
						sub_phone: this.sub_phone.value,
						sub_subject: this.sub_subject.value,
						sub_school: this.sub_school.value,
						sub_gradeLevel: this.sub_gradeLevel.value
					};
					if (entry.id == 0) { // add
						Substitutes.storeAdd(entry);
						Substitutes.tableAdd(entry);
					}
					else { // edit
						Substitutes.storeEdit(entry);
						Substitutes.tableEdit(entry);
					}

					this.reset();
					this.id_entry.value = 0;
					event.preventDefault();
				}, true);

				// initialize table
				if (window.localStorage.length - 1) {
					var Substitutes_list = [], i, key;
					for (i = 0; i < window.localStorage.length; i++) {
						key = window.localStorage.key(i);
						if (/Substitutes:\d+/.test(key)) {
							Substitutes_list.push(JSON.parse(window.localStorage.getItem(key)));
						}
					}

					if (Substitutes_list.length) {
						Substitutes_list
							.sort(function(a, b) {
								return a.id < b.id ? -1 : (a.id > b.id ? 1 : 0);
							})
							.forEach(Substitutes.tableAdd);
					}
				}
				Substitutes.$table.addEventListener("click", function(event) {
					var op = event.target.getAttribute("data-op");
					if (/edit|remove/.test(op)) {
						var entry = JSON.parse(window.localStorage.getItem("Substitutes:"+ event.target.getAttribute("data-id")));
						if (op == "edit") {
							Substitutes.$form.sub_name.value = entry.sub_name;
							Substitutes.$form.sub_SSN.value = entry.sub_SSN;
							Substitutes.$form.sub_PIN.value = entry.sub_PIN;
							Substitutes.$form.sub_phone.value = entry.sub_phone;
							Substitutes.$form.sub_subject.value = entry.sub_subject;
							Substitutes.$form.sub_school.value = entry.sub_school;
							Substitutes.$form.sub_gradeLevel.value = entry.sub_gradeLevel;
							Substitutes.$form.id_entry.value = entry.id;
						}
						else if (op == "remove") {
							if (confirm('Are you sure you want to remove "'+ entry.sub_name +' '+ entry.sub_SSN +'" from your Substitutes?')) {
								Substitutes.storeRemove(entry);
								Substitutes.tableRemove(entry);
							}
						}
						event.preventDefault();
					}
				}, true);
			},

			storeAdd: function(entry) {
				entry.id = Substitutes.index;
				window.localStorage.setItem("Substitutes:index", ++Substitutes.index);
				window.localStorage.setItem("Substitutes:"+ entry.id, JSON.stringify(entry));
			},
			storeEdit: function(entry) {
				window.localStorage.setItem("Substitutes:"+ entry.id, JSON.stringify(entry));
			},
			storeRemove: function(entry) {
				window.localStorage.removeItem("Substitutes:"+ entry.id);
			},

			tableAdd: function(entry) {
				var $tr = document.createElement("tr"), $td, key;
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
				$tr.setAttribute("id", "entry-"+ entry.id);
				Substitutes.$table.appendChild($tr);
			},
			tableEdit: function(entry) {
				var $tr = document.getElementById("entry-"+ entry.id), $td, key;
				$tr.innerHTML = "";
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
			},
			tableRemove: function(entry) {
				Substitutes.$table.removeChild(document.getElementById("entry-"+ entry.id));
			}
		};
		Substitutes.init();
	</script>
	
</body>
</html>